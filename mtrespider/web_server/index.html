<html>

<head>
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!--Import Google Icon Font-->
  <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css">
  <!--Import Roslibjs-->  
  <script type="text/javascript" src="eventemitter2.min.js"></script>
  <script type="text/javascript" src="roslib.min.js"></script>
    <script type="text/javascript" src="jquery-2.2.2.min.js"></script>
</head>

<body>
	<nav>
	  <div class="nav-wrapper center cyan darken-3">
		  <i class="material-icons">search</i>
	  </div>
    </nav>
	
	<div class="row container">
	  <div id="main-frame1-on-small" class="video-div col s12 m6">
		  <img class="responsive-img" src="http://192.168.10.101:8080/stream?topic=/spider/camera/front/image_raw">
	  </div>
	  <div id="main-frame2-on-small" class="video-div hide-on-small-only col s12 m6">
		  <img class="responsive-img" src="http://192.168.10.101:8080/stream?topic=/spider/camera/rear/image_raw">
	  </div>
	</div>
	<div class="row container">
		<div class="hide-on-med-and-up col s5 offset-s4">
			<a class="waves-effect waves-light btn-large" onclick="toggleImage()">Toggle Image</a>
		</div>
	</div>
	<div class="row container">
		<div class="col s4 m2 right">
			<div class="switch">
				<label>
				  Off
				  <input type="checkbox" id="current-position-switch" onclick="pubCurrentPosition(this)">
				  <span class="lever"></span>
				  On
		     	</label>
			</div>
		</div>
	</div>
  
  <script type="text/javascript" type="text/javascript">
	  
	  function toggleImage()
	  {
		  imageFront = $('#main-frame1-on-small');
		  imageRear = $('#main-frame2-on-small');
		  
		  if(imageFront.hasClass("hide-on-small-only") == true){
			  imageFront.removeClass("hide-on-small-only");
			  imageRear.addClass("hide-on-small-only");
		  }
		  
		  else {
			  imageFront.addClass("hide-on-small-only");
			  imageRear.removeClass("hide-on-small-only");
		  }
		  
	  }
	  
	  function setSwitchPosition()
	  {  
		  // Connecting to ROS
		  // -----------------

		  var ros = new ROSLIB.Ros({
			url : 'ws://192.168.10.101:9090'
		  });

		  ros.on('connection', function() {
			console.log('Connected to websocket server.');
		  });

		  ros.on('error', function(error) {
			console.log('Error connecting to websocket server: ', error);
		  });

		  ros.on('close', function() {
			console.log('Connection to websocket server closed.');
		  });
		  
		  // Subscribing to Current Position
		  // ----------------------

		  var listener = new ROSLIB.Topic({
			ros : ros,
			name : '/spider/transducerarm/position_current',
			messageType : 'std_msgs/Bool'
		  });

		  listener.subscribe(function(message) {
			  
			if(message.data == true)
			{
				$('#current-position-switch').prop('checked', true);
			}
			
			else
			{
				$('#current-position-switch').prop('checked', false);
			}
			
			listener.unsubscribe();
		  });
	  }
	  
	  function setPositionSetpoint(bool){
		  // Connecting to ROS
		  // -----------------

		  var ros = new ROSLIB.Ros({
			url : 'ws://192.168.10.101:9090'
		  });

		  ros.on('connection', function() {
			console.log('Connected to websocket server.');
		  });

		  ros.on('error', function(error) {
			console.log('Error connecting to websocket server: ', error);
		  });

		  ros.on('close', function() {
			console.log('Connection to websocket server closed.');
		  });
		  
		  // Publishing a Topic
		  // ------------------

		  var setPositionBool = new ROSLIB.Topic({
			ros : ros,
			name : '/spider/transducerarm/position_setpoint',
			messageType : 'std_msgs/Bool'
		  });

		  var msg = new ROSLIB.Message({
			data : bool
		  });
		  
		  setPositionBool.publish(msg);
		}
	  
	  function pubCurrentPosition(swtch){
		  // Connecting to ROS
		  // -----------------

		  var ros = new ROSLIB.Ros({
			url : 'ws://192.168.10.101:9090'
		  });

		  ros.on('connection', function() {
			console.log('Connected to websocket server.');
		  });

		  ros.on('error', function(error) {
			console.log('Error connecting to websocket server: ', error);
		  });

		  ros.on('close', function() {
			console.log('Connection to websocket server closed.');
		  });
		  
		  // Subscribing to Current Position
		  // ----------------------

		  var listener = new ROSLIB.Topic({
			ros : ros,
			name : '/spider/transducerarm/position_current',
			messageType : 'std_msgs/Bool'
		  });

		  listener.subscribe(function(message) {
			  
			if(message.data == true)
			{
				setPositionSetpoint(false);
				swtch.checked = false;
			}
			
			else
			{
				setPositionSetpoint(true);
				swtch.checked = true;
			}
			
			listener.unsubscribe();
		  });
	  }
	  
	  $(document).ready(function() {
		  setSwitchPosition();
	  });
	</script>
  <!--Import jQuery before materialize.js-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js"></script>
</body>

</html>
